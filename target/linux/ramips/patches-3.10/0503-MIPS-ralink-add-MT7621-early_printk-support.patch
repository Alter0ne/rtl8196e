From 643e61b22155cd95ae6e18e57da50acd120da091 Mon Sep 17 00:00:00 2001
From: John Crispin <blogic@openwrt.org>
Date: Mon, 2 Dec 2013 16:11:33 +0100
Subject: [PATCH 503/507] MIPS: ralink: add MT7621 early_printk support

Signed-off-by: John Crispin <blogic@openwrt.org>
---
 arch/mips/ralink/early_printk.c |   10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

Index: linux-3.10.21/arch/mips/ralink/early_printk.c
===================================================================
--- linux-3.10.21.orig/arch/mips/ralink/early_printk.c	2013-11-29 20:12:03.000000000 +0100
+++ linux-3.10.21/arch/mips/ralink/early_printk.c	2013-12-09 20:11:51.600704498 +0100
@@ -13,6 +13,8 @@
 
 #ifdef CONFIG_SOC_RT288X
 #define EARLY_UART_BASE         0x300c00
+#elif defined(CONFIG_SOC_MT7621)
+#define EARLY_UART_BASE         0x1E000c00
 #else
 #define EARLY_UART_BASE         0x10000c00
 #endif
@@ -40,9 +42,13 @@
 
 void prom_putchar(unsigned char ch)
 {
-	while ((uart_r32(UART_REG_LSR) & UART_LSR_THRE) == 0)
+#ifdef CONFIG_SOC_MT7621
+	uart_w32(ch, UART_TX);
+	while ((uart_r32(0x14) & UART_LSR_THRE) == 0)
 		;
-	uart_w32(ch, UART_REG_TX);
+#else
 	while ((uart_r32(UART_REG_LSR) & UART_LSR_THRE) == 0)
 		;
+	uart_w32(ch, UART_REG_TX);
+#endif
 }
